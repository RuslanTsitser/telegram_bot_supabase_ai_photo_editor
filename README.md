# Telegram Bot –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

Telegram –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é Google Gemini AI.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –ª–∏–º–∏—Ç–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Yookassa –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
- –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Deno 1.40+ (–¥–ª—è Supabase Edge Functions)
- Go 1.21+ (–¥–ª—è GCP Image Uploader)
- Supabase –∞–∫–∫–∞—É–Ω—Ç
- Telegram Bot Token
- Google Gemini API –∫–ª—é—á

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```structure

telegram_bot_supabase_ai_photo_editor/
|--- gcp-image-uploader/                   # –í–Ω–µ—à–Ω–∏–π API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å Google Gemini AI
    |--- deploy.sh                         # –î–µ–ø–ª–æ–π
    |--- Dockerfile                        # Dockerfile
    |--- main.go                           # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª
    |--- go.mod                            # –ú–æ–¥—É–ª–∏
    |--- go.sum                            # –°—É–º–º–∞ –º–æ–¥—É–ª–µ–π
    |--- README.md                         # README
|--- supabase/
    |--- functions/
        |--- image-generator/              # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å Google Gemini AI
            |--- scripts/               # –°–∫—Ä–∏–ø—Ç—ã
                |--- deploy.sh             # –î–µ–ø–ª–æ–π
                |--- run.sh                # –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ
                |--- set_bot.sh            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –≤ –±–æ—Ç–µ
                |--- set_env.sh            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
            |--- src/               # –°–∫—Ä–∏–ø—Ç—ã
                |--- api/                  # API
                |--- storage/              # Storage
                |--- telegram/             # Telegram –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                |--- utils/                # –£—Ç–∏–ª–∏—Ç—ã
            |--- .env                  # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
            |--- .env.example          # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
            |--- deno.json             # Deno –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
            |--- index.ts              # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞
|--- README.md
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd telegram_bot_supabase_ai_photo_editor
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
cp supabase/functions/image-generator/.env.example supabase/functions/image-generator/.env
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

- `BOT_TOKEN` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `BOT_FUNCTION_SECRET` - —Å–µ–∫—Ä–µ—Ç –¥–ª—è webhook
- `GEMINI_API_KEY` - API –∫–ª—é—á Google Gemini
- `YOOKASSA_PROVIDER_TOKEN` - —Ç–æ–∫–µ–Ω Yookassa –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- `YOOKASSA_PROVIDER_TOKEN_TEST` - —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω Yookassa
- `PROJECT_ID` - ID –ø—Ä–æ–µ–∫—Ç–∞ Supabase
- `IMAGE_UPLOADER_API_URL` - URL API –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### 3. –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –ó–∞–ø—É—Å–∫ Supabase —Ñ—É–Ω–∫—Ü–∏–∏
cd supabase/functions/image-generator
bash scripts/run.sh

# –ó–∞–ø—É—Å–∫ GCP Image Uploader
cd gcp-image-uploader
bash scripts/run.sh
```

### 4. –î–µ–ø–ª–æ–π

```bash
# –î–µ–ø–ª–æ–π Supabase —Ñ—É–Ω–∫—Ü–∏–∏
cd supabase/functions/image-generator
bash scripts/deploy.sh

# –î–µ–ø–ª–æ–π GCP Image Uploader
cd gcp-image-uploader
bash scripts/deploy.sh
```

## –ë–∏–∑–Ω–µ—Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –¢–∞–±–ª–∏—Ü—ã

#### users

id - uuid
telegram_id - telegram id
telegram_username - telegram username
telegram_first_name - telegram first name
telegram_last_name - telegram last name
telegram_photo_url - telegram photo url

#### premium_statuses

id - uuid
user_id - uuid - –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –∫ —Ç–∞–±–ª–∏—Ü–µ users
is_premium - —ç—Ç–æ –ø–æ–ª–µ –ø–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω—ã–π –ø—Ä–µ–º–∏—É–º. –Ø –∫–∞–∫ –∞–¥–º–∏–Ω –º–æ–≥—É –Ω–∞–∑–Ω–∞—á–∞—Ç—å, –∫–æ–º—É –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
premium_expires_at - –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –∫—É–ø–∏–ª –ø—Ä–µ–º–∏—É–º. –° –ø–æ–¥–ø–∏—Å–∫–æ–π - –±–µ–∑–ª–∏–º–∏—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
generation_limit - –¥–ª—è —Ç–µ—Ö, —É –∫–æ–≥–æ –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ 5)

#### subscription_plans

id - uuid
name - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞
description - –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞
price - —Ü–µ–Ω–∞ —Ç–∞—Ä–∏—Ñ–∞ –≤ —Ä—É–±–ª—è—Ö
type - —Ç–∏–ø —Ç–∞—Ä–∏—Ñ–∞ (–ø–æ–¥–ø–∏—Å–∫–∞ –∏–ª–∏ —Ä–∞–∑–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂)
value - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü (–¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π, –¥–ª—è —Ä–∞–∑–æ–≤–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤)

#### payments

id - uuid
user_id - uuid - –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –∫ —Ç–∞–±–ª–∏—Ü–µ users
plan_id - uuid - –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –∫ —Ç–∞–±–ª–∏—Ü–µ subscription_plans
youkassa_payment_id - id –ø–ª–∞—Ç–µ–∂–∞ –≤ –Æ–∫–∞—Å—Å–µ
amount - —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞
currency - –≤–∞–ª—é—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞
status - —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–º–∏—É–º–∞ –∏ —Ç–∞—Ä–∏—Ñ–∞

1) –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è—é is_premium - —ç—Ç–æ –ø–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω—ã–π –ø—Ä–µ–º–∏—É–º. –Ø –∫–∞–∫ –∞–¥–º–∏–Ω –º–æ–≥—É –Ω–∞–∑–Ω–∞—á–∞—Ç—å, –∫–æ–º—É –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
2) –ï—Å–ª–∏ –Ω–µ –ø—Ä–µ–º–∏—É–º, —Ç–æ –ø—Ä–æ–≤–µ—Ä—è—é –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞. –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å premium_expires_at. –ï—Å–ª–∏ –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –±–æ–ª—å—à–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã, —Ç–æ –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞.
3) –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏, —Ç–æ –ø—Ä–æ–≤–µ—Ä—è—é generation_limit

### –¢–∞—Ä–∏—Ñ—ã

1) –ù–µ–¥–µ–ª—å–Ω—ã–π —Ç–∞—Ä–∏—Ñ –Ω–∞ 7 –¥–Ω–µ–π
2) 5 –∑–∞–ø—Ä–æ—Å–æ–≤
3) 10 –∑–∞–ø—Ä–æ—Å–æ–≤

### –ö–æ–º–∞–Ω–¥—ã

- `/start` - –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º. –ü–æ–ª—É—á–∏—Ç—å –±–∞–∑–æ–≤—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
- `/subscriptions` - —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤
- `/limits` - —Å–ø–∏—Å–æ–∫ –ª–∏–º–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (`git checkout -b feature/amazing-feature`)
3. –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git commit -m 'Add some amazing feature'`)
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ –≤–µ—Ç–∫—É (`git push origin feature/amazing-feature`)
5. –û—Ç–∫—Ä–æ–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ MIT License - —Å–º. —Ñ–∞–π–ª [LICENSE](LICENSE) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, —Å–æ–∑–¥–∞–π—Ç–µ [Issue](https://github.com/your-username/telegram_bot_supabase_ai_photo_editor/issues) –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
